<html>
    <head>
    <title>Content-Hash Linking - Scuttlebot - SSBC</title>
    <link rel="stylesheet" href="/normalize.css">
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/atelier-forest-light.css">
    <script src="/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
    <body>
      <div id="topnav">
    <div id="topnav-inner">
      <a class="topnav-item " href="/" title="Home">
      Home<br><small>SSBC</small>
    </a>
      <a class="topnav-item " href="/patchwork" title="Patchwork">
      Patchwork<br><small>Social Messaging App</small>
    </a>
      <a class="topnav-item " href="/scuttlebot" title="Scuttlebot">
      Scuttlebot<br><small>P2P Log Store</small>
    </a>
      <a class="topnav-item selected" href="/docs" title="Documentation">
      Documentation<br><small>APIs, Articles</small>
    </a>
    </div>
  </div>
      <div id="layout">
        <div id="leftnav">
      <div class="leftnav-item">Key Concepts</div>
      <div class="leftnav-subitems">
        <div class="leftnav-item ">
      <a href="/secure-scuttlebutt" title="Secure Scuttlebutt: a global database protocol">Secure Scuttlebutt: a global database protocol</a>
    </div>
        <div class="leftnav-item selected">
      <a href="/docs/ssb/linking.html" title="Content-Hash Linking">Content-Hash Linking</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/ssb/secret-handshake.html" title="Secret Handshake: a secure channel protocol">Secret Handshake: a secure channel protocol</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/ssb/end-to-end-encryption.html" title="Private Box: metadata-free encryption">Private Box: metadata-free encryption</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/ssb/faq.html" title="Frequently Asked Questions">Frequently Asked Questions</a>
    </div>
      </div>
      <div class="leftnav-item">API Documentation</div>
      <div class="leftnav-subitems">
        <div class="leftnav-item ">
      <a href="/scuttlebot/api.html" title="scuttlebot">scuttlebot</a>
    </div>
        <div class="leftnav-indent">
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/blobs.html" title="blobs">blobs</a>
    </div>
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/block.html" title="block">block</a>
    </div>
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/friends.html" title="friends">friends</a>
    </div>
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/gossip.html" title="gossip">gossip</a>
    </div>
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/invite.html" title="invite">invite</a>
    </div>
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/private.html" title="private">private</a>
    </div>
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/replicate.html" title="replicate">replicate</a>
    </div>
        </div>
        <div class="leftnav-item ">
      <a href="/ssb-client" title="ssb-client">ssb-client</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-feed" title="ssb-feed">ssb-feed</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-keys" title="ssb-keys">ssb-keys</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-msgs" title="ssb-msgs">ssb-msgs</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-msg-schemas" title="ssb-msg-schemas">ssb-msg-schemas</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-ref" title="ssb-ref">ssb-ref</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-markdown" title="ssb-markdown">ssb-markdown</a>
    </div>
        <div class="leftnav-item ">
      <a href="/patchwork-threads" title="patchwork-threads">patchwork-threads</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-config" title="ssb-config">ssb-config</a>
    </div>
        <div class="leftnav-item ">
      <a href="/secret-stack" title="secret-stack">secret-stack</a>
    </div>
        <div class="leftnav-item ">
      <a href="/muxrpc" title="muxrpc">muxrpc</a>
    </div>
        <div class="leftnav-item ">
      <a href="/muxrpcli" title="muxrpcli">muxrpcli</a>
    </div>
        <div class="leftnav-item ">
      <a href="/mdmanifest" title="mdmanifest">mdmanifest</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/api/pull-stream.html" title="pull-stream">pull-stream</a>
    </div>
      </div>
    </div>
        <div id="content">
          <h1 id="content-hash-linking">Content-Hash Linking</h1>
<p>Messages, feeds, and blobs are addressable by specially-formatted identifiers.
Message and blob IDs are content-hashes, while feed IDs are public keys.</p>
<p>To indicate the type of ID, a &quot;sigil&quot; is prepended to the string. They are:</p>
<ul>
<li><code>@</code> for feeds</li>
<li><code>%</code> for messages</li>
<li><code>&amp;</code> for blobs</li>
</ul>
<p>Additionally, each ID has a &quot;tag&quot; appended to indicate the hash or key algorithm.
Some example IDs:</p>
<ul>
<li>A feed: <code>@LA9HYf5rnUJFHHTklKXLLRyrEytayjbFZRo76Aj/qKs=.ed25519</code></li>
<li>A message: <code>%MPB9vxHO0pvi2ve2wh6Do05ZrV7P6ZjUQ+IEYnzLfTs=.sha256</code></li>
<li>A blob: <code>&amp;Pe5kTo/V/w4MToasp1IuyMrMcCkQwDOdyzbyD5fy4ac=.sha256</code></li>
</ul>
<hr>
<p>When IDs are found in the messages, they may be treated as links, with the keyname acting as a &quot;relation&quot; type.
An example of this:</p>
<pre><code class="lang-bash">sbot publish --type post \
  --root &quot;%MPB9vxHO0pvi2ve2wh6Do05ZrV7P6ZjUQ+IEYnzLfTs=.sha256&quot; \
  --branch &quot;%kRi8MzGDWw2iKNmZak5STshtzJ1D8G/sAj8pa4bVXLI=.sha256&quot; \
  --text &quot;this is a reply!&quot;
</code></pre>
<pre><code class="lang-js">sbot.publish({
  type: &quot;post&quot;,
  root: &quot;%MPB9vxHO0pvi2ve2wh6Do05ZrV7P6ZjUQ+IEYnzLfTs=.sha256&quot;,
  branch: &quot;%kRi8MzGDWw2iKNmZak5STshtzJ1D8G/sAj8pa4bVXLI=.sha256&quot;,
  text: &quot;this is a reply!&quot;
})
</code></pre>
<p>In this example, the <code>root</code> and <code>branch</code> keys are the relations.
SSB automatically builds an index based on these links, to allow queries such as &quot;all messages with a <code>root</code> link to this message.&quot;</p>
<hr>
<p>If you want to include data in the link object, you can specify an object with the id in the <code>link</code> subattribute:</p>
<pre><code class="lang-bash">sbot publish --type post \
  --mentions.link &quot;@LA9HYf5rnUJFHHTklKXLLRyrEytayjbFZRo76Aj/qKs=.ed25519&quot; \
  --mentions.name bob \
  --text &quot;hello, @bob&quot;
</code></pre>
<pre><code class="lang-js">sbot.publish({
  type: &quot;post&quot;,
  mentions: { 
    link: &quot;@LA9HYf5rnUJFHHTklKXLLRyrEytayjbFZRo76Aj/qKs=.ed25519&quot;,
    name: &quot;bob&quot;
  },
  text: &quot;hello, @bob&quot;
})
</code></pre>
<hr>
<p>To query the link-graph, use <a href="https://github.com/ssbc/scuttlebot/blob/master/api.md#links-source">links</a>:</p>
<pre><code class="lang-bash">sbot links [--source id|filter] [--dest id|filter] [--rel value]
</code></pre>
<pre><code class="lang-js">pull(sbot.links({ source:, dest:, rel: }), pull.drain(...))
</code></pre>
<p>You can provide either the source or the destination.
Both can be set to a sigil to filter; for instance, using <code>&#39;&amp;&#39;</code> will filter to blobs, as <code>&amp;</code> is the sigil that precedes blob IDs.
You can also include a relation-type filter.</p>
<p>Here are some example queries:</p>
<pre><code class="lang-bash"># all links pointing to this message
sbot links \
  --dest %6sHHKhwjVTFVADme55JVW3j9DoWbSlUmemVA6E42bf8=.sha256

# all &quot;about&quot; links pointing to this user
sbot links \
  --rel about \
  --dest @hxGxqPrplLjRG2vtjQL87abX4QKqeLgCwQpS730nNwE=.ed25519

# all blob links from this user
sbot links \
  --dest &quot;&amp;&quot; \
  --source @hxGxqPrplLjRG2vtjQL87abX4QKqeLgCwQpS730nNwE=.ed25519
</code></pre>
<pre><code class="lang-js">// all links pointing to this message
pull(
  sbot.links({
    dest: &#39;%6sHHKhwjVTFVADme55JVW3j9DoWbSlUmemVA6E42bf8=.sha256&#39;
  }),
  pull.drain(...)
)

// all &quot;about&quot; links pointing to this user
pull(
  sbot.links({
    rel: &#39;about&#39;,
    dest: &#39;@hxGxqPrplLjRG2vtjQL87abX4QKqeLgCwQpS730nNwE=.ed25519&#39;
  }),
  pull.drain(...)
)

// all blob links from this user
pull(
  sbot.links({
    dest: &#39;&amp;&#39;,
    source: &#39;@hxGxqPrplLjRG2vtjQL87abX4QKqeLgCwQpS730nNwE=.ed25519&#39;
  }),
  pull.drain(...)
)
</code></pre>
<hr>
<p>A common pattern is to recursively fetch the links that point to a message, creating a tree.
This is useful for creating comment-threads, for instance.</p>
<p>You can do that easily in scuttlebot with <a href="https://github.com/ssbc/scuttlebot/blob/master/api.md#relatedmessages-async">relatedMessages</a>.</p>
<pre><code class="lang-bash">sbot relatedMessages --id {id}
</code></pre>
<pre><code class="lang-js">sbot.relatedMessages({ id: id }, cb)
</code></pre>

        </div>
      </div>
    </body>
  </html>